services:
  web:
    build: .
    ports:
        - 8000:8000
    volumes:
        - .:/app
        - static_data:/data/web/static
        - media_data:/data/web/media
    env_file:
        - ./dotenv_files/.env
    depends_on:
        - psql
    
  nginx: 
    image: nginx:1.25-alpine
    restart: always
    ports:
        - 8080:80
    volumes:
        - .:/app:ro
        - static_data:/data/web/static:ro
        - media_data:/data/web/media:ro
        - ./nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
        - web

  psql:
    container_name: psql
    image: postgres:16-alpine
    volumes:
        - psql_data:/var/lib/postgresql/data/
    env_file:
        - ./dotenv_files/.env

volumes:
    psql_data:
    static_data:
    media_data:
